<?xml version="1.0"?>
<!--
 *************************************************************************
 * Copyright (c) 2004, 2005 Actuate Corporation.
 * All rights reserved. This program and the accompanying materials
 * are made available under the terms of the Eclipse Public License v1.0
 * which accompanies this distribution, and is available at
 * http://www.eclipse.org/legal/epl-v10.html
 *
 * Contributors:
 *  Actuate Corporation  - initial API and implementation
 *  
 *************************************************************************
 *

-->
<project name="Birt Language Pack Daily Build" default="main" basedir=".">
	
    <property name="checkout.version" value=""/>
	<property name="oda.build.version" value="" />

	   <property name="birt.build.tools.dir" value="${p4.home}/dailybuild/source/org.eclipse.birt.build"/>

	    <path id="lib.path">
	            <fileset dir="${p4.home}/dailybuild/source/org.eclipse.birt.build" includes="*.jar,lib/*.jar"/>
	    </path>
    <typedef name="dynamicProperty" classname="org.apache.tools.ant.taskdefs.Property" classpathref="lib.path" loaderref="lib.path.loader"/>
    <typedef name="versionUpdate" classname="org.eclipse.birt.build.VersionUpdater" classpath="${birt.build.tools.dir}/bin" classpathref="lib.path" loaderref="lib.path.loader"/>
    <typedef name="projectInfo" classname="org.eclipse.birt.build.ProjectInfo" classpath="${birt.build.tools.dir}/bin" classpathref="lib.path" loaderref="lib.path.loader" />
    <typedef name="projectList" classname="org.eclipse.birt.build.ProjectList" classpath="${birt.build.tools.dir}/bin" classpathref="lib.path" loaderref="lib.path.loader" />
    <taskdef name="forEach" classname="org.eclipse.birt.build.ForEach" classpath="${birt.build.tools.dir}/bin" classpathref="lib.path" loaderref="lib.path.loader"/>
    <taskdef name="reliableTask" classname="org.eclipse.birt.build.ReliableTask" classpath="${birt.build.tools.dir}/bin" classpathref="lib.path" loaderref="lib.path.loader"/>	
	
	<projectList id="language.pack.list">
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.device.extension.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.device.svg.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.device.swt.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.engine.extension.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.engine.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.reportitem.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.reportitem.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.ui.extension.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.chart.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.core.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.core.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.data.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.viewer.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.data.oda.jdbc.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.data.oda.jdbc.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.data.oda.sampledb.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.data.oda.sampledb.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.data.oda.xml.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.debug.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.core.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.editors.schematic.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.ide.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.lib.explorer.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.lib.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.preview.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.designer.ui.rcp.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.engine.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.birt.report.model.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
        <projectInfo>
			<property name="projectName" value="org.eclipse.birt.resources.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
        <projectInfo>
			<property name="projectName" value="org.eclipse.birt.integration.wtp.ui.nl" />
			<property name="repositoryPath" value="source/nl" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="" />
			<property name="cvsRoot" value="${cvs.root}" />
		</projectInfo>
	</projectList>
	<projectList id="ODA.language.pack.list">
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.consumer.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.flatfile.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.profile.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.design.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.design.ui.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.flatfile.ui.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.ui.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.ui.dse.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.connectivity.oda.template.ui.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.enablement.oda.xml.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
		<projectInfo>
			<property name="projectName" value="org.eclipse.datatools.enablement.oda.xml.ui.nl" />
			<property name="repositoryPath" value="${ODA.repository.nl.path}" />
			<property name="buildFileName" value="build.xml" />
			<property name="cvs.options" value="${oda.build.version}" />
			<property name="cvsRoot" value="${oda.cvs.root}" />
		</projectInfo>
	</projectList>
	<!-- public part-->

	<target name="updatePluginVersion" unless="not.update.plugin.version">
		<versionUpdate projectPath="${projectPath}" suffix=".${buildId}" checkFlag="N" />
	</target>
	<!-- public part -->
	<target name="main" >
		<antcall target="UpdateNLVersion" />
		<antcall target="UpdateODANLVersion"/>
		<antcall target="CompileNL"/>
		<antcall target="CompileODANL"/>
		<antcall target="Export" />
		<antcall target="ExportODA" />
		<antcall target="compileFeatureOverlay"/>
		<antcall target="exportFeatureOverlay"/>
	</target>
	
	<target name="UpdateNLVersion" >
		<forEach iteratorId="language.pack.list" failonerror="false" failureProperty="task.status">
			<dynamicProperty name="projectName" value="current.projectName" />
			<antcall target="updatePluginVersion" inheritall="false">
				<param name="projectPath" value="${buildDirectory}/plugins/${projectName}" />
				<param name="buildId" value="${buildId}" />
			</antcall>
		</forEach>
	</target>
	<target name="UpdateODANLVersion" >
		<forEach iteratorId="ODA.language.pack.list" failonerror="false" failureProperty="task.status">
			<dynamicProperty name="projectName" value="current.projectName" />
			<antcall target="updatePluginVersion" inheritall="false">
				<param name="projectPath" value="${buildDirectory}/plugins/${projectName}" />
				<param name="buildId" value="${buildId}" />
			</antcall>
		</forEach>
	</target>

	<target name="CompileNL" >
		<forEach iteratorId="language.pack.list" failonerror="false" failureProperty="task.status">
			<dynamicProperty name="projectName" value="current.projectName" />
			<dynamicProperty name="buildfile" value="current.buildFileName" />

			<echo message="TOP level start target [Jar] on ${projectName} at ${plugin.Compile.start.time}." level="info" />
			<ant dir="${buildDirectory}/plugins/${projectName}" antfile="${buildfile}" target="Jar">
			</ant>
			
		</forEach>
	</target>
	
	<target name="CompileODANL" >
		<forEach iteratorId="ODA.language.pack.list" failonerror="false" failureProperty="task.status">
			<dynamicProperty name="projectName" value="current.projectName" />
			<dynamicProperty name="buildfile" value="current.buildFileName" />

			<ant dir="${buildDirectory}/plugins/${projectName}" antfile="${buildfile}" target="Jar">
			</ant>
			
		</forEach>
	</target>
	
	<target name="Export" >
		<mkdir dir="${buildDirectory}/${buildLabel}/language_pack/plugins"/>
		<mkdir dir="${buildDirectory}/${buildLabel}/language_pack/features"/>

		<forEach iteratorId="language.pack.list" failonerror="false" >
			<dynamicProperty name="projectName" value="current.projectName" />
			<dynamicProperty name="buildfile" value="current.buildFileName" />
			<echo message="TOP level(Export iteration), calling Export on ${projectName}" level="info" />
			<ant dir="${buildDirectory}/plugins/${projectName}" antfile="build.xml" target="Export" inheritall="false" inheritrefs="false">
				<property name="export.dir" value="${buildDirectory}/${buildLabel}/language_pack/plugins" />
				<property name="TODAY" value="${timestamp.BUILD_ID1}" />
				<property name="BUILD_ID" value="${timestamp.BUILD_ID2}" />
			</ant>
		</forEach>
	</target>
	
	<target name="ExportODA" >
		<forEach iteratorId="ODA.language.pack.list" failonerror="false" >
			<dynamicProperty name="projectName" value="current.projectName" />
			<dynamicProperty name="buildfile" value="current.buildFileName" />
			<echo message="TOP level(Export iteration), calling Export on ${projectName}" level="info" />
			<ant dir="${buildDirectory}/plugins/${projectName}" antfile="build.xml" target="Export" inheritall="false" inheritrefs="false">
				<property name="export.dir" value="${buildDirectory}/${buildLabel}/language_pack/plugins" />
				<property name="TODAY" value="${timestamp.BUILD_ID1}" />
				<property name="BUILD_ID" value="${timestamp.BUILD_ID2}" />
			</ant>
		</forEach>
	</target>
	<target name="compileFeatureOverlay">
		<native2ascii dest="${buildDirectory}/features" src="${buildDirectory}/features" encoding="Cp1252" includes="**/*_de_DE.msg"  ext=".properties" />
		<native2ascii dest="${buildDirectory}/features" src="${buildDirectory}/features" encoding="Cp1252" includes="**/*_es_ES.msg"  ext=".properties" />
		<native2ascii dest="${buildDirectory}/features" src="${buildDirectory}/features" encoding="Cp1252" includes="**/*_fr_FR.msg"  ext=".properties" />
		<native2ascii dest="${buildDirectory}/features" src="${buildDirectory}/features" encoding="GBK" includes="**/*_zh_CN.msg"   ext=".properties" />
		<native2ascii dest="${buildDirectory}/features" src="${buildDirectory}/features" encoding="SJIS" includes="**/*_ja_JP.msg" ext=".properties" />
		<native2ascii dest="${buildDirectory}/features" src="${buildDirectory}/features" encoding="MS949" includes="**/*ko_KR.msg" ext=".properties" />
	</target>
	<target name="exportFeatureOverlay">
		<property file="${buildDirectory}/finalFeaturesVersions.properties"/>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.chart_${org.eclipse.birt.chart}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.chart">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.chart.runtime_${org.eclipse.birt.chart.runtime}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.chart.runtime">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.doc_${org.eclipse.birt.doc}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.doc">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.example_${org.eclipse.birt.example}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.example">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.report.designer_${org.eclipse.birt.report.designer}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.report.designer">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.report.runtime_${org.eclipse.birt.report.runtime}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.report.runtime">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
		<copy todir="${buildDirectory}/${buildLabel}/language_pack/features/org.eclipse.birt.sdk_${org.eclipse.birt.sdk}">
			<fileset dir="${buildDirectory}/features/org.eclipse.birt.sdk">
				<include name="*_??_??.properties"/>
			</fileset>
		</copy>
	</target>
</project>